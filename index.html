<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CDC Escape Room</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex items-center justify-center p-4">
  <div id="root" class="w-full max-w-2xl bg-gray-900 rounded-2xl shadow-xl p-8 space-y-8 border border-gray-700"></div>

  <!-- CDN links for React, ReactDOM, and Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    // Define the puzzles, their correct answers, and the next steps.
    const puzzles = {
      1: {
        answer: 'QUARANTINE',
        nextClue: 'Great! You have successfully accessed the main system. The next clue is hidden in the biosafety cabinet. Look for a combination lock. The combination is the last 4 digits of the patient ID for patient zero. The patient ID is in the "Patient Records" file on the admin desk.',
      },
      2: {
        answer: '5934',
        nextClue: 'You are making great progress! Now that you have the key, you can access the specimen storage. The final puzzle awaits you there. The antidote is stored in a container labeled "Project Chimera". The code to open the container is a 3-letter sequence from the virus\'s genetic code, found in the lab notes.',
      },
      3: {
        answer: 'TGA',
        nextClue: 'Congratulations, agent! You have successfully synthesized the antidote and saved the world from the Crimson Scourge. Evacuate the facility immediately. You win!',
      },
    };

    const initialPlayerState = {
      'player-1': { currentPuzzle: 1, puzzlesSolved: [] },
      'player-2': { currentPuzzle: 1, puzzlesSolved: [] },
    };

    const App = () => {
      const [currentPlayerId, setCurrentPlayerId] = useState(null);
      const [puzzleInput, setPuzzleInput] = useState('');
      const [feedback, setFeedback] = useState({ message: '', type: '' });
      const [appState, setAppState] = useState(initialPlayerState);

      // Handle the user's puzzle answer submission.
      const handleAnswerSubmit = (e) => {
        e.preventDefault();
        
        if (!currentPlayerId) {
          setFeedback({ message: 'Please select an Agent ID first!', type: 'error' });
          return;
        }

        const currentPlayer = appState[currentPlayerId];
        if (!currentPlayer) {
            setFeedback({ message: 'Invalid Agent ID selected. Please try again.', type: 'error' });
            return;
        }
        
        const currentPuzzle = puzzles[currentPlayer.currentPuzzle];
        
        // Check if the input is correct (case-insensitive for flexibility).
        if (puzzleInput.toUpperCase() === currentPuzzle.answer.toUpperCase()) {
          // Correct answer! Update the player's progress.
          const newAppState = { ...appState };
          newAppState[currentPlayerId].puzzlesSolved.push(currentPlayer.currentPuzzle);
          newAppState[currentPlayerId].currentPuzzle += 1;
          setAppState(newAppState);
          
          // Provide the next clue.
          setFeedback({ message: currentPuzzle.nextClue, type: 'success' });
          setPuzzleInput(''); // Clear the input field for the next puzzle.
        } else {
          // Incorrect answer.
          setFeedback({ message: 'Incorrect answer. Please try again.', type: 'error' });
        }
      };

      // Reset the app to allow a new user to select their ID.
      const handleReset = () => {
        setCurrentPlayerId(null);
        setPuzzleInput('');
        setFeedback({ message: '', type: '' });
      };

      // Render different parts of the UI based on the app's state.
      return (
        <div className="min-h-screen bg-gray-950 text-white flex flex-col items-center justify-center p-4 font-sans antialiased">
          <div className="w-full max-w-2xl bg-gray-900 rounded-2xl shadow-xl p-8 space-y-8 border border-gray-700">
            <header className="text-center">
              <h1 className="text-4xl font-bold text-red-500 tracking-wider mb-2">CDC ALERT</h1>
              <p className="text-xl text-gray-300">Operation: Antidote</p>
            </header>

            {currentPlayerId ? (
              // UI for when a user has selected their ID.
              <>
                <h2 className="text-2xl font-semibold text-center text-gray-100">
                  Agent ID: <span className="text-red-400">{currentPlayerId.toUpperCase()}</span>
                </h2>
                <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 space-y-4">
                  <p className="text-lg text-gray-200">
                    You are currently on Puzzle {appState[currentPlayerId]?.currentPuzzle}.
                  </p>
                  
                  {feedback.message && (
                    <div 
                      className={`p-4 rounded-lg text-sm transition-all duration-300 ease-in-out ${
                        feedback.type === 'success' ? 'bg-green-700 text-white shadow-lg' : 'bg-red-700 text-white shadow-lg'
                      }`}
                    >
                      <p>{feedback.message}</p>
                    </div>
                  )}

                  {/* Show the input form only if the player hasn't solved all puzzles. */}
                  {appState[currentPlayerId]?.currentPuzzle <= Object.keys(puzzles).length && (
                    <form onSubmit={handleAnswerSubmit} className="space-y-4">
                      <div>
                        <label htmlFor="puzzle-input" className="block text-gray-400 mb-2">
                          Enter the solution to the puzzle:
                        </label>
                        <input
                          id="puzzle-input"
                          type="text"
                          value={puzzleInput}
                          onChange={(e) => setPuzzleInput(e.target.value)}
                          className="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:ring-red-500 focus:border-red-500"
                          placeholder="Enter your answer here..."
                          required
                        />
                      </div>
                      <button
                        type="submit"
                        className="w-full p-3 rounded-lg bg-red-600 text-white font-bold text-lg hover:bg-red-700 transition-colors duration-300 shadow-md"
                      >
                        Submit Answer
                      </button>
                    </form>
                  )}
                </div>
                <button
                  onClick={handleReset}
                  className="w-full p-3 rounded-lg bg-gray-700 text-gray-300 font-bold hover:bg-gray-600 transition-colors duration-300"
                >
                  Change Agent
                </button>
              </>
            ) : (
              // UI for when no user is logged in, showing the player selection.
              <>
                <h2 className="text-2xl font-semibold text-center text-gray-100">
                  Select Your Agent ID to Begin
                </h2>
                <div className="w-full flex justify-center p-4 rounded-xl border-gray-700">
                  <select
                    onChange={(e) => setCurrentPlayerId(e.target.value)}
                    value=""
                    className="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white appearance-none focus:ring-red-500 focus:border-red-500"
                  >
                    <option value="" disabled>Select an Agent</option>
                    {Object.keys(initialPlayerState).map((id) => (
                      <option key={id} value={id}>
                        {id.toUpperCase()}
                      </option>
                    ))}
                  </select>
                </div>
              </>
            )}
          </div>
        </div>
      );
    };

    const rootElement = document.getElementById('root');
    createRoot(rootElement).render(React.createElement(App));
  </script>
</body>
</html>
